<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNS Orientation Explorer</title>
    <!-- Brain emoji favicon for consistency -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text
        y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        .chart-container {
            position: relative;
            min-height: 250px;
            max-height: 400px;
            margin-bottom: 1rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .brain-model-container {
            position: relative;
            min-height: 350px;
            max-height: 500px;
            width: 100%;
            overflow: hidden;
        }

        .plane-indicator {
            position: absolute;
            border: 2px solid;
            pointer-events: none;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .direction-arrow {
            position: absolute;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .direction-arrow:hover {
            transform: scale(1.1);
        }

        .quiz-option {
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background-color: #f0f9ff;
        }

        .quiz-option.correct {
            background-color: #dcfce7;
            border-color: #22c55e;
        }

        .quiz-option.incorrect {
            background-color: #fee2e2;
            border-color: #ef4444;
        }

        #brain-section-display {
            max-width: 500px;
            max-height: 350px;
            margin: 0 auto;
            background: #000;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        #brain-section-display canvas {
            display: block;
            margin: 0 auto;
            background: #000;
            border-radius: 0.5rem;
        }

        #sagittal-plane-illustration,
        #coronal-plane-illustration,
        #horizontal-plane-illustration {
            width: 300px !important;
            height: 200px !important;
            display: block;
            margin: 0 auto;
        }

        .quiz-option.bg-blue-100 {
            background-color: #2563eb !important;
            /* Tailwind blue-600 */
            color: #fff !important;
            border: 2px solid #1d4ed8 !important;
            /* Tailwind blue-700 */
        }

        @media (max-width: 800px) {

            header,
            main,
            footer,
            .container {
                padding-left: 0.5em !important;
                padding-right: 0.5em !important;
            }

            .rounded-lg,
            .rounded,
            .shadow-md,
            .shadow-lg {
                border-radius: 0 !important;
                box-shadow: none !important;
            }

            .max-w-6xl {
                max-width: 100vw !important;
            }

            .brain-model-container,
            #brain-section-display,
            .aspect-w-4,
            .aspect-h-3,
            .aspect-w-1,
            .aspect-h-1 {
                min-width: 0 !important;
                width: 100% !important;
                max-width: 100vw !important;
                min-height: 180px !important;
                max-height: 260px !important;
                height: 180px !important;
            }

            #brain-section-display canvas,
            #sagittal-plane-illustration,
            #coronal-plane-illustration,
            #horizontal-plane-illustration {
                width: 100% !important;
                height: 120px !important;
                min-width: 0 !important;
                min-height: 0 !important;
                max-width: 100vw !important;
                max-height: 160px !important;
            }

            .tab-link,
            .plane-button,
            .direction-button,
            .imaging-plane-button,
            select,
            button,
            input[type="range"] {
                font-size: 1em !important;
                padding: 0.5em 0.7em !important;
            }

            .grid-cols-2,
            .md\:grid-cols-2,
            .grid-cols-3,
            .lg\:grid-cols-2,
            .lg\:grid-cols-3 {
                grid-template-columns: 1fr !important;
            }

            .flex,
            .md\:flex-row {
                flex-direction: column !important;
            }

            .quiz-option {
                font-size: 0.95em !important;
                padding: 0.5em 0.7em !important;
            }

            h1 {
                font-size: 1.4em !important;
            }

            h2,
            h3 {
                font-size: 1.1em !important;
            }

            .mb-8 {
                margin-bottom: 1.5em !important;
            }

            .p-6 {
                padding: 1em !important;
            }

            .py-8 {
                padding-top: 1em !important;
                padding-bottom: 1em !important;
            }

            .px-4 {
                padding-left: 0.5em !important;
                padding-right: 0.5em !important;
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans">
    <!-- Sticky Home button for navigation -->
    <nav class="w-full flex items-center px-2 py-3 bg-white border-b border-gray-200 sticky top-0 z-30">
        <a href="index.html"
            class="flex items-center text-blue-700 font-semibold text-base md:text-lg hover:underline focus:outline-none focus:ring-2 focus:ring-blue-400 rounded transition">
            <span class="mr-2 text-xl md:text-2xl">‚Üê</span>
            <span class="hidden xs:inline md:inline">Home</span>
        </a>
    </nav>

    <!-- Consistent colored header -->
    <header class="bg-blue-700 text-white p-6 shadow-md mb-8">
        <div class="container mx-auto">
            <h1 class="text-3xl font-bold mb-2">CNS Orientation Explorer</h1>
            <p class="text-xl">An interactive guide to orientation and planes in the human central nervous system
            </p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold text-blue-700 mb-4">What makes the human CNS orientation unique?</h2>
            <p class="mb-4">The human central nervous system has a unique feature that can make understanding its
                orientation challenging: <strong>a flexure of approximately 120 degrees</strong> between the hindbrain
                and forebrain.</p>
            <p class="mb-4">This flexure creates a situation where directional terms can mean different things depending
                on which part of the brain you're referring to. Let's explore how this works!</p>
            <div class="flex justify-center my-6">
                <button id="start-exploration"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105">
                    Begin Interactive Exploration
                </button>
            </div>
        </div>

        <div id="main-explorer" class="hidden">
            <!-- Tab Navigation -->
            <div class="mb-6 border-b border-gray-200">
                <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
                    <li class="mr-2">
                        <a href="#"
                            class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-blue-600 hover:border-blue-600 active"
                            data-tab="3d-model">3D Brain Model</a>
                    </li>
                    <li class="mr-2">
                        <a href="#"
                            class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-blue-600 hover:border-blue-600"
                            data-tab="directional-terms">Directional Terms</a>
                    </li>
                    <li class="mr-2">
                        <a href="#"
                            class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-blue-600 hover:border-blue-600"
                            data-tab="section-planes">Planes of Section</a>
                    </li>
                    <li class="mr-2">
                        <a href="#"
                            class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-blue-600 hover:border-blue-600"
                            data-tab="quiz">Test Your Knowledge</a>
                    </li>
                </ul>
            </div>

            <!-- Tab Content -->
            <div class="tab-content active" id="3d-model-content">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-4">Interactive 3D Brain Model</h2>
                    <p class="mb-4">Explore the human brain in 3D to understand its orientation and the flexure between
                        the hindbrain and forebrain. Rotate the model using your mouse and use the controls below to
                        highlight different planes and directions.</p>

                    <div class="brain-model-container mb-6" id="brain-model">
                        <!-- 3D model will be rendered here -->
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-2">Highlight Plane:</h3>
                            <div class="flex flex-wrap gap-2">
                                <button
                                    class="plane-button bg-blue-100 hover:bg-blue-200 text-blue-800 font-medium py-2 px-4 rounded"
                                    data-plane="sagittal">Sagittal</button>
                                <button
                                    class="plane-button bg-green-100 hover:bg-green-200 text-green-800 font-medium py-2 px-4 rounded"
                                    data-plane="coronal">Coronal</button>
                                <button
                                    class="plane-button bg-purple-100 hover:bg-purple-200 text-purple-800 font-medium py-2 px-4 rounded"
                                    data-plane="horizontal">Horizontal</button>
                                <button
                                    class="plane-button bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded"
                                    data-plane="none">Clear All</button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-2">Highlight Direction:</h3>
                            <div class="flex flex-wrap gap-2">
                                <button
                                    class="direction-button bg-red-100 hover:bg-red-200 text-red-800 font-medium py-2 px-4 rounded"
                                    data-direction="rostral-caudal">Rostral-Caudal</button>
                                <button
                                    class="direction-button bg-yellow-100 hover:bg-yellow-200 text-yellow-800 font-medium py-2 px-4 rounded"
                                    data-direction="dorsal-ventral">Dorsal-Ventral</button>
                                <button
                                    class="direction-button bg-indigo-100 hover:bg-indigo-200 text-indigo-800 font-medium py-2 px-4 rounded"
                                    data-direction="anterior-posterior">Anterior-Posterior</button>
                                <button
                                    class="direction-button bg-pink-100 hover:bg-pink-200 text-pink-800 font-medium py-2 px-4 rounded"
                                    data-direction="medial-lateral">Medial-Lateral</button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">Key Observation:</h3>
                        <p>Notice how the ~120¬∞ flexure between the hindbrain and forebrain affects the directional
                            terms. This is why terms like "dorsal" and "ventral" point in different directions depending
                            on whether you're referring to the forebrain or hindbrain.</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="directional-terms-content">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-4">Directional Terms in the CNS</h2>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6">
                        <div>
                            <h3 class="text-xl font-medium text-blue-600 mb-3">Terms Relative to Body Axis</h3>
                            <p class="mb-3">These terms maintain the same direction throughout the CNS because they
                                reference the straight body axis:</p>

                            <div class="space-y-4 mb-6">
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <h4 class="font-semibold">Anterior / Posterior</h4>
                                    <p><strong>Anterior:</strong> Toward the front of the body</p>
                                    <p><strong>Posterior:</strong> Toward the back of the body</p>
                                </div>

                                <div class="bg-green-50 p-3 rounded-lg">
                                    <h4 class="font-semibold">Superior / Inferior</h4>
                                    <p><strong>Superior:</strong> Toward the top of the body</p>
                                    <p><strong>Inferior:</strong> Toward the bottom of the body</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-xl font-medium text-blue-600 mb-3">Terms Relative to CNS Axis</h3>
                            <p class="mb-3">These terms follow the curved axis of the CNS and change direction at the
                                flexure:</p>

                            <div class="space-y-4 mb-6">
                                <div class="bg-red-50 p-3 rounded-lg">
                                    <h4 class="font-semibold">Rostral / Caudal</h4>
                                    <p><strong>Rostral:</strong> Toward the nose (forebrain) or top of head (hindbrain)
                                    </p>
                                    <p><strong>Caudal:</strong> Toward the tail/coccyx</p>
                                </div>

                                <div class="bg-yellow-50 p-3 rounded-lg">
                                    <h4 class="font-semibold">Dorsal / Ventral</h4>
                                    <p><strong>Dorsal:</strong> Toward the back (hindbrain) or top of head (forebrain)
                                    </p>
                                    <p><strong>Ventral:</strong> Toward the belly/gut</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-xl font-medium text-blue-600 mb-3">Additional Important Terms</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-purple-50 p-3 rounded-lg">
                                <h4 class="font-semibold">Medial / Lateral</h4>
                                <p><strong>Medial:</strong> Toward the midline of the CNS</p>
                                <p><strong>Lateral:</strong> Away from the midline, toward the side</p>
                            </div>

                            <div class="bg-indigo-50 p-3 rounded-lg">
                                <h4 class="font-semibold">Ipsilateral / Contralateral</h4>
                                <p><strong>Ipsilateral:</strong> On the same side (as another structure)</p>
                                <p><strong>Contralateral:</strong> On the opposite side</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">Interactive Exploration:</h3>
                        <p class="mb-3">Use the slider below to see how directional terms change across different parts
                            of the CNS due to the flexure.</p>

                        <div class="mb-4">
                            <label for="cns-region-slider" class="block text-sm font-medium text-gray-700 mb-1">Select
                                CNS Region:</label>
                            <input type="range" id="cns-region-slider" min="0" max="2" step="1" value="1"
                                class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs text-gray-600 mt-1">
                                <span>Spinal Cord</span>
                                <span>Hindbrain</span>
                                <span>Forebrain</span>
                            </div>
                        </div>

                        <div class="relative h-64 border border-gray-300 rounded-lg bg-white overflow-hidden"
                            id="direction-visualization">
                            <!-- Direction arrows will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="section-planes-content">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-4">Standard Planes of Section</h2>
                    <p class="mb-4">The brain is commonly viewed and sectioned in three standard orthogonal planes.
                        Understanding these planes is crucial for interpreting brain images and sections.</p>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold text-blue-800 mb-2">Sagittal Plane</h3>
                            <div class="aspect-w-4 aspect-h-3 mb-3">
                                <div class="w-full h-48 bg-gray-200 rounded flex items-center justify-center">
                                    <canvas id="sagittal-plane-illustration" width="300" height="200"></canvas>
                                </div>
                            </div>
                            <p><strong>Definition:</strong> Divides the brain into left and right portions</p>
                            <p><strong>Orientation:</strong> Parallel to the midline</p>
                            <p><strong>View:</strong> Shows structures as they would appear from the side</p>
                            <p><strong>Mnemonic:</strong> Think of Sagittarius (the archer) shooting an arrow from side
                                to side</p>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold text-green-800 mb-2">Coronal (Frontal) Plane</h3>
                            <div class="aspect-w-4 aspect-h-3 mb-3">
                                <div class="w-full h-48 bg-gray-200 rounded flex items-center justify-center">
                                    <canvas id="coronal-plane-illustration" width="300" height="200"></canvas>
                                </div>
                            </div>
                            <p><strong>Definition:</strong> Divides the brain into anterior and posterior portions</p>
                            <p><strong>Orientation:</strong> Perpendicular to the sagittal plane</p>
                            <p><strong>View:</strong> Shows structures as they would appear from the front or back</p>
                            <p><strong>Mnemonic:</strong> Think of a crown (corona) worn on the front of the head</p>
                        </div>

                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold text-purple-800 mb-2">Horizontal (Axial) Plane</h3>
                            <div class="aspect-w-4 aspect-h-3 mb-3">
                                <div class="w-full h-48 bg-gray-200 rounded flex items-center justify-center">
                                    <canvas id="horizontal-plane-illustration" width="300" height="200"></canvas>
                                </div>
                            </div>
                            <p><strong>Definition:</strong> Divides the brain into superior and inferior portions</p>
                            <p><strong>Orientation:</strong> Parallel to the ground (when standing)</p>
                            <p><strong>View:</strong> Shows structures as they would appear from above or below</p>
                            <p><strong>Mnemonic:</strong> Think of the horizon (horizontal)</p>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-xl font-medium text-blue-600 mb-3">Plane Selection in Medical Imaging</h3>
                        <p class="mb-4">In medical imaging (MRI, CT), the choice of plane is important for visualizing
                            different structures. Use the interactive tool below to see how different planes reveal
                            different aspects of brain anatomy.</p>

                        <div class="bg-gray-100 p-6 rounded-lg mb-8">
                            <div class="flex flex-wrap gap-3 mb-6">
                                <button
                                    class="imaging-plane-button bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded active"
                                    data-plane="sagittal">Sagittal View</button>
                                <button
                                    class="imaging-plane-button bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded"
                                    data-plane="coronal">Coronal View</button>
                                <button
                                    class="imaging-plane-button bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded"
                                    data-plane="horizontal">Horizontal View</button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <div class="aspect-w-1 aspect-h-1 mb-4">
                                        <div class="w-full h-64 bg-black rounded flex items-center justify-center">
                                            <div id="brain-section-display" class="w-full h-full"></div>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-2 mt-4 mb-4">
                                        <span class="text-sm text-gray-600" id="section-position-label">Position:
                                            Mid-brain</span>
                                        <input type="range" id="section-position-slider" min="0" max="100" value="50"
                                            class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
                                    </div>
                                </div>

                                <div class="bg-white p-6 rounded-lg shadow mb-4">
                                    <h4 class="font-semibold mb-3" id="plane-description-title">Sagittal Plane Features
                                    </h4>
                                    <ul class="list-disc pl-5 space-y-2" id="plane-description-list">
                                        <li>Best for visualizing midline structures</li>
                                        <li>Shows the lateral ventricles and third ventricle</li>
                                        <li>Clearly displays the corpus callosum</li>
                                        <li>Reveals the brainstem's relationship to the cerebrum</li>
                                        <li>Demonstrates the brain flexure between hindbrain and forebrain</li>
                                    </ul>
                                    <div class="mt-5">
                                        <h5 class="font-medium">Clinical Applications:</h5>
                                        <p id="plane-clinical-applications">Sagittal MRI is often used to evaluate
                                            midline structures, pituitary abnormalities, and corpus callosum
                                            development.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-yellow-50 p-4 rounded-lg mt-10 mb-8">
                        <h3 class="text-lg font-semibold text-yellow-800 mb-2">Important Note on Cross-Sections:</h3>
                        <p>Due to the flexure in the CNS, the standard planes have different relationships to the neural
                            axis in different regions:</p>
                        <ul class="list-disc pl-5 mt-2">
                            <li><strong>Forebrain:</strong> Coronal sections are closest to cross-sections
                                (perpendicular to the long axis)</li>
                            <li><strong>Brainstem:</strong> Horizontal sections are closest to cross-sections</li>
                            <li>This difference is important when interpreting neuroanatomical images and sections</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="quiz-content">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-4">Test Your Knowledge</h2>
                    <p class="mb-6">Apply what you've learned about CNS orientation and planes of section by answering
                        these questions.</p>

                    <div class="space-y-8">
                        <div class="quiz-question bg-blue-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-3">Question 1: Directional Terms</h3>
                            <p class="mb-4">In the forebrain, which of the following pairs of directional terms point in
                                the SAME direction?</p>

                            <div class="space-y-2" id="q1-options">
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">A. Rostral and Posterior</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">B. Dorsal and Ventral</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="true">
                                    <span class="font-medium">C. Dorsal and Superior</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">D. Caudal and Anterior</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">E. Ventral and Superior</span>
                                </div>
                            </div>

                            <div class="mt-4 hidden" id="q1-explanation">
                                <h4 class="font-semibold text-blue-800">Explanation:</h4>
                                <p>In the forebrain, dorsal points toward the top of the head, and superior also points
                                    toward the top of the head. Therefore, these terms point in the same direction in
                                    the forebrain region.</p>
                            </div>
                        </div>

                        <div class="quiz-question bg-green-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-3">Question 2: Planes of Section</h3>
                            <p class="mb-4">In conventional human radiological imaging (e.g., MRI, PET, CT) of the head,
                                which of the following statements about the axial plane is most accurate?</p>

                            <div class="space-y-2" id="q2-options">
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">A. The axial plane is parallel to the coronal
                                        plane.</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">B. The axial plane is parallel to the sagittal
                                        plane.</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="true">
                                    <span class="font-medium">C. The axial plane is parallel to the floor of the
                                        cranium.</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">D. The axial plane is in the plane of the face.</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">E. The long axis of the spinal cord is in the axial plane
                                        of the cranium.</span>
                                </div>
                            </div>

                            <div class="mt-4 hidden" id="q2-explanation">
                                <h4 class="font-semibold text-green-800">Explanation:</h4>
                                <p>The axial (horizontal) plane in radiological imaging is typically oriented parallel
                                    to the floor of the cranium. This is the standard orientation for axial MRI and CT
                                    scans of the brain.</p>
                            </div>
                        </div>

                        <div class="quiz-question bg-purple-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-3">Question 3: Perpendicular Directions</h3>
                            <p class="mb-4">Of the following pairs of directional terms, which pair contains terms that
                                define PERPENDICULAR (orthogonal) directions when applied to the identified region of
                                the central nervous system?</p>

                            <div class="space-y-2" id="q3-options">
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">A. In the forebrain, rostral & anterior</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="true">
                                    <span class="font-medium">B. In the forebrain, dorsal & anterior</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">C. In the forebrain, ventral & inferior</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">D. In the brainstem, ventral & anterior</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">E. In the spinal cord, caudal & posterior</span>
                                </div>
                            </div>

                            <div class="mt-4 hidden" id="q3-explanation">
                                <h4 class="font-semibold text-purple-800">Explanation:</h4>
                                <p>In the forebrain, dorsal points toward the top of the head, while anterior points
                                    toward the face. These directions are perpendicular to each other in the forebrain
                                    due to the flexure in the CNS.</p>
                            </div>
                        </div>

                        <div class="quiz-question bg-red-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-3">Question 4: Brain Flexure</h3>
                            <p class="mb-4">The flexure in the human CNS occurs at which junction?</p>

                            <div class="space-y-2" id="q4-options">
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">A. Between the cerebrum and cerebellum</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="true">
                                    <span class="font-medium">B. Between the midbrain and diencephalon</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">C. Between the medulla and spinal cord</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">D. Between the pons and medulla</span>
                                </div>
                                <div class="quiz-option border border-gray-300 rounded-lg p-3 cursor-pointer"
                                    data-correct="false">
                                    <span class="font-medium">E. Between the two cerebral hemispheres</span>
                                </div>
                            </div>

                            <div class="mt-4 hidden" id="q4-explanation">
                                <h4 class="font-semibold text-red-800">Explanation:</h4>
                                <p>The flexure in the human CNS occurs at the junction of the midbrain and diencephalon.
                                    This creates an approximately 120-degree angle between the long axes of the
                                    hindbrain and forebrain.</p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 text-center">
                        <button id="check-answers"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300">
                            Check Answers
                        </button>
                        <button id="reset-quiz"
                            class="ml-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 hidden">
                            Reset Quiz
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Consistent dark footer -->
    <footer class="bg-gray-800 text-white p-6 mt-8">
        <div class="container mx-auto">
            <p class="text-center">CNS Orientation Explorer | Educational Simulation</p>
        </div>
    </footer>
    <!-- Custom footer as in other chapters -->
    <footer style="text-align:center; color:#888; font-size:0.9em; margin-top:2em;">
        Made by Mario Athanasiou ‚Ä¢ <a href="https://www.linkedin.com/in/mario-athanasiou/"
            style="color:#457b9d;">Connect on LinkedIn</a>
    </footer>

    <script>
        // Main initialization
        document.addEventListener('DOMContentLoaded', function () {
            // Show main explorer when start button is clicked
            document.getElementById('start-exploration').addEventListener('click', function () {
                document.getElementById('main-explorer').classList.remove('hidden');
                this.parentElement.parentElement.classList.add('hidden');

                // Initialize the 3D model
                initBrainModel();

                // Initialize the plane illustrations
                initPlaneIllustrations();

                // Initialize the brain section display
                initBrainSectionDisplay();

                // Initialize the direction visualization
                initDirectionVisualization();
            });

            // Tab navigation
            document.querySelectorAll('.tab-link').forEach(function (tab) {
                tab.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Remove active class from all tabs
                    document.querySelectorAll('.tab-link').forEach(function (t) {
                        t.classList.remove('active', 'text-blue-600', 'border-blue-600');
                        t.classList.add('border-transparent');
                    });

                    // Add active class to clicked tab
                    this.classList.add('active', 'text-blue-600', 'border-blue-600');
                    this.classList.remove('border-transparent');

                    // Hide all tab content
                    document.querySelectorAll('.tab-content').forEach(function (content) {
                        content.classList.remove('active');
                    });

                    // Show corresponding tab content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId + '-content').classList.add('active');
                });
            });

            // Quiz functionality
            document.querySelectorAll('.quiz-option').forEach(function (option) {
                option.addEventListener('click', function () {
                    // Toggle selection within the question group
                    const questionGroup = this.closest('.quiz-question');
                    questionGroup.querySelectorAll('.quiz-option').forEach(function (opt) {
                        opt.classList.remove('bg-blue-100');
                    });
                    this.classList.add('bg-blue-100');
                });
            });

            document.getElementById('check-answers').addEventListener('click', function () {
                let score = 0;
                const totalQuestions = document.querySelectorAll('.quiz-question').length;

                document.querySelectorAll('.quiz-question').forEach(function (question, index) {
                    const selectedOption = question.querySelector('.quiz-option.bg-blue-100');
                    const options = question.querySelectorAll('.quiz-option');

                    options.forEach(function (option) {
                        option.classList.remove('correct', 'incorrect');

                        if (option.getAttribute('data-correct') === 'true') {
                            option.classList.add('correct');
                        }
                    });

                    if (selectedOption) {
                        if (selectedOption.getAttribute('data-correct') === 'true') {
                            score++;
                        } else {
                            selectedOption.classList.add('incorrect');
                        }
                    }

                    // Show explanation
                    document.getElementById(`q${index + 1}-explanation`).classList.remove('hidden');
                });

                // Show reset button and hide check button
                this.classList.add('hidden');
                document.getElementById('reset-quiz').classList.remove('hidden');

                // Show score in the page
                const resultBox = document.getElementById('quiz-result-box');
                if (resultBox) resultBox.remove();

                let newResultBox = document.createElement('div');
                newResultBox.id = 'quiz-result-box';
                newResultBox.className = 'mt-6 mb-4 p-4 rounded-lg text-lg font-semibold text-center';
                newResultBox.textContent = `You scored ${score} out of ${totalQuestions}!`;
                newResultBox.style.background = score === totalQuestions ? '#dcfce7' : '#fef9c3';
                newResultBox.style.color = score === totalQuestions ? '#166534' : '#92400e';
                this.parentElement.insertBefore(newResultBox, this);
            });

            document.getElementById('reset-quiz').addEventListener('click', function () {
                document.querySelectorAll('.quiz-option').forEach(function (option) {
                    option.classList.remove('bg-blue-100', 'correct', 'incorrect');
                });

                document.querySelectorAll('[id$="-explanation"]').forEach(function (explanation) {
                    explanation.classList.add('hidden');
                });

                // Hide reset button and show check button
                this.classList.add('hidden');
                document.getElementById('check-answers').classList.remove('hidden');
            });

            // Imaging plane buttons
            document.querySelectorAll('.imaging-plane-button').forEach(function (button) {
                button.addEventListener('click', function () {
                    document.querySelectorAll('.imaging-plane-button').forEach(function (btn) {
                        btn.classList.remove('active', 'bg-blue-700', 'bg-green-700', 'bg-purple-700');

                        if (btn.getAttribute('data-plane') === 'sagittal') {
                            btn.classList.add('bg-blue-600');
                        } else if (btn.getAttribute('data-plane') === 'coronal') {
                            btn.classList.add('bg-green-600');
                        } else if (btn.getAttribute('data-plane') === 'horizontal') {
                            btn.classList.add('bg-purple-600');
                        }
                    });

                    const plane = this.getAttribute('data-plane');
                    this.classList.add('active');

                    if (plane === 'sagittal') {
                        this.classList.add('bg-blue-700');
                        document.getElementById('plane-description-title').textContent = 'Sagittal Plane Features';
                        document.getElementById('plane-description-list').innerHTML = `
                            <li>Best for visualizing midline structures</li>
                            <li>Shows the lateral ventricles and third ventricle</li>
                            <li>Clearly displays the corpus callosum</li>
                            <li>Reveals the brainstem's relationship to the cerebrum</li>
                            <li>Demonstrates the brain flexure between hindbrain and forebrain</li>
                        `;
                        document.getElementById('plane-clinical-applications').textContent = 'Sagittal MRI is often used to evaluate midline structures, pituitary abnormalities, and corpus callosum development.';
                    } else if (plane === 'coronal') {
                        this.classList.add('bg-green-700');
                        document.getElementById('plane-description-title').textContent = 'Coronal Plane Features';
                        document.getElementById('plane-description-list').innerHTML = `
                            <li>Best for visualizing bilateral structures</li>
                            <li>Shows both hemispheres simultaneously</li>
                            <li>Clearly displays the basal ganglia and thalamus</li>
                            <li>Useful for evaluating the ventricular system</li>
                            <li>Good for assessing brain symmetry</li>
                        `;
                        document.getElementById('plane-clinical-applications').textContent = 'Coronal MRI is particularly useful for evaluating temporal lobe structures, hippocampus, and pituitary gland.';
                    } else if (plane === 'horizontal') {
                        this.classList.add('bg-purple-700');
                        document.getElementById('plane-description-title').textContent = 'Horizontal Plane Features';
                        document.getElementById('plane-description-list').innerHTML = `
                            <li>Most commonly used plane in clinical imaging</li>
                            <li>Best for visualizing the ventricular system</li>
                            <li>Shows the relationship between cortical and subcortical structures</li>
                            <li>Ideal for evaluating the brainstem</li>
                            <li>Provides cross-sectional view of the cerebellum</li>
                        `;
                        document.getElementById('plane-clinical-applications').textContent = 'Horizontal (axial) MRI is the standard for routine brain evaluation, stroke assessment, and tumor localization.';
                    }

                    updateBrainSectionDisplay(plane);
                });
            });

            // Section position slider
            document.getElementById('section-position-slider').addEventListener('input', function () {
                const position = this.value;
                const plane = document.querySelector('.imaging-plane-button.active').getAttribute('data-plane');

                let positionLabel = '';
                if (position < 25) {
                    positionLabel = plane === 'sagittal' ? 'Left lateral' : (plane === 'coronal' ? 'Anterior' : 'Superior');
                } else if (position < 50) {
                    positionLabel = plane === 'sagittal' ? 'Left parasagittal' : (plane === 'coronal' ? 'Anterior-mid' : 'Superior-mid');
                } else if (position === '50') {
                    positionLabel = plane === 'sagittal' ? 'Midline' : (plane === 'coronal' ? 'Mid-brain' : 'Mid-brain');
                } else if (position < 75) {
                    positionLabel = plane === 'sagittal' ? 'Right parasagittal' : (plane === 'coronal' ? 'Posterior-mid' : 'Inferior-mid');
                } else {
                    positionLabel = plane === 'sagittal' ? 'Right lateral' : (plane === 'coronal' ? 'Posterior' : 'Inferior');
                }

                document.getElementById('section-position-label').textContent = `Position: ${positionLabel}`;
                updateBrainSectionDisplay(plane, position);
            });

            // CNS region slider for directional terms
            document.getElementById('cns-region-slider').addEventListener('input', function () {
                updateDirectionVisualization(parseInt(this.value));
            });

            // Re-initialize the brain section display on resize
            window.addEventListener('resize', function () {
                if (document.getElementById('main-explorer') && !document.getElementById('main-explorer').classList.contains('hidden')) {
                    initBrainSectionDisplay();
                }
            });
        });

        // 3D Brain Model
        function initBrainModel() {
            try {
                const container = document.getElementById('brain-model');

                // Create scene
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf8fafc);

                // Create camera
                const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                camera.position.z = 5;

                // Create renderer
                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                container.appendChild(renderer.domElement);

                // Create a simple brain model
                const brainGeometry = new THREE.Group();

                // Forebrain (cerebrum)
                const forebrainGeometry = new THREE.SphereGeometry(1.5, 32, 32);
                const forebrainMaterial = new THREE.MeshLambertMaterial({ color: 0xe0e0e0 });
                const forebrain = new THREE.Mesh(forebrainGeometry, forebrainMaterial);
                forebrain.position.set(0, 0.5, 0);
                forebrain.scale.set(1, 0.8, 1);
                brainGeometry.add(forebrain);

                // Midbrain
                const midbrainGeometry = new THREE.CylinderGeometry(0.4, 0.5, 0.8, 32);
                const midbrainMaterial = new THREE.MeshLambertMaterial({ color: 0xd0d0d0 });
                const midbrain = new THREE.Mesh(midbrainGeometry, midbrainMaterial);
                midbrain.position.set(0, -0.5, 0);
                midbrain.rotation.x = Math.PI / 6; // Slight angle to show flexure
                brainGeometry.add(midbrain);

                // Hindbrain (cerebellum and brainstem)
                const hindbrainGeometry = new THREE.SphereGeometry(0.8, 32, 32);
                const hindbrainMaterial = new THREE.MeshLambertMaterial({ color: 0xc0c0c0 });
                const hindbrain = new THREE.Mesh(hindbrainGeometry, hindbrainMaterial);
                hindbrain.position.set(0, -1.2, -0.3);
                hindbrain.scale.set(1, 0.7, 1);
                brainGeometry.add(hindbrain);

                // Brainstem
                const brainstemGeometry = new THREE.CylinderGeometry(0.3, 0.2, 1.2, 32);
                const brainstemMaterial = new THREE.MeshLambertMaterial({ color: 0xb0b0b0 });
                const brainstem = new THREE.Mesh(brainstemGeometry, brainstemMaterial);
                brainstem.position.set(0, -2, -0.5);
                brainstem.rotation.x = Math.PI / 3; // Angle to show flexure
                brainGeometry.add(brainstem);

                // Add the brain to the scene
                scene.add(brainGeometry);

                // Add lights
                const ambientLight = new THREE.AmbientLight(0x404040);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(1, 1, 1);
                scene.add(directionalLight);

                const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.5);
                directionalLight2.position.set(-1, -1, -1);
                scene.add(directionalLight2);

                // Add planes
                const sagittalPlane = createPlane(0x3b82f6, 0.01, 4, 4);
                sagittalPlane.rotation.y = Math.PI / 2;
                sagittalPlane.visible = false;
                scene.add(sagittalPlane);

                const coronalPlane = createPlane(0x22c55e, 0.01, 4, 4);
                coronalPlane.visible = false;
                scene.add(coronalPlane);

                const horizontalPlane = createPlane(0xa855f7, 0.01, 4, 4);
                horizontalPlane.rotation.x = Math.PI / 2;
                horizontalPlane.visible = false;
                scene.add(horizontalPlane);

                // Add direction arrows (keys match data-direction attributes)
                const arrows = {
                    'rostral-caudal': createArrowGroup(0xff0000, 'R', 'C', [0, 0, 2.5], [0, -2.5, -1]),
                    'dorsal-ventral': createArrowGroup(0xffaa00, 'D', 'V', [0, 2, 0], [0, -0.5, -2]),
                    'anterior-posterior': createArrowGroup(0x0066ff, 'A', 'P', [0, 0, 2.5], [0, 0, -2.5]),
                    'medial-lateral': createArrowGroup(0xff00ff, 'M', 'L', [0, 0, 0], [2.5, 0, 0])
                };

                Object.values(arrows).forEach(arrow => {
                    arrow.visible = false;
                    scene.add(arrow);
                });

                // Add controls
                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.25;

                // Handle window resize
                window.addEventListener('resize', function () {
                    camera.aspect = container.clientWidth / container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.clientWidth, container.clientHeight);
                });

                // Animation loop
                function animate() {
                    requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                }

                animate();

                // Plane button handlers
                document.querySelectorAll('.plane-button').forEach(function (button) {
                    button.addEventListener('click', function () {
                        const plane = this.getAttribute('data-plane');

                        sagittalPlane.visible = plane === 'sagittal';
                        coronalPlane.visible = plane === 'coronal';
                        horizontalPlane.visible = plane === 'horizontal';

                        if (plane === 'none') {
                            sagittalPlane.visible = false;
                            coronalPlane.visible = false;
                            horizontalPlane.visible = false;
                        }
                    });
                });

                // Direction button handlers
                document.querySelectorAll('.direction-button').forEach(function (button) {
                    button.addEventListener('click', function () {
                        const direction = this.getAttribute('data-direction');

                        Object.keys(arrows).forEach(key => {
                            arrows[key].visible = key === direction;
                        });
                    });
                });

                // Helper function to create a plane
                function createPlane(color, thickness, width, height) {
                    const geometry = new THREE.BoxGeometry(width, height, thickness);
                    const material = new THREE.MeshBasicMaterial({
                        color: color,
                        transparent: true,
                        opacity: 0.5,
                        side: THREE.DoubleSide
                    });
                    return new THREE.Mesh(geometry, material);
                }

                // Helper function to create arrow group
                function createArrowGroup(color, startLabel, endLabel, startPos, endPos) {
                    const group = new THREE.Group();

                    // Create arrow line
                    const points = [
                        new THREE.Vector3(...startPos),
                        new THREE.Vector3(...endPos)
                    ];

                    const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
                    const lineMaterial = new THREE.LineBasicMaterial({ color: color, linewidth: 3 });
                    const line = new THREE.Line(lineGeometry, lineMaterial);
                    group.add(line);

                    // Create arrow heads (cones)
                    const headGeometry = new THREE.ConeGeometry(0.1, 0.3, 32);
                    const headMaterial = new THREE.MeshBasicMaterial({ color: color });

                    const startHead = new THREE.Mesh(headGeometry, headMaterial);
                    startHead.position.set(...startPos);

                    const endHead = new THREE.Mesh(headGeometry, headMaterial);
                    endHead.position.set(...endPos);
                    endHead.rotation.x = Math.PI;

                    group.add(startHead);
                    group.add(endHead);

                    return group;
                }
            } catch (error) {
                console.error("Error initializing brain model:", error);
                document.getElementById('brain-model').innerHTML = `
                    <div class="flex items-center justify-center h-full bg-red-50 text-red-800 p-4 rounded-lg">
                        <p>Error loading 3D model. Please try refreshing the page.</p>
                    </div>
                `;
            }
        }

        // Plane Illustrations
        function initPlaneIllustrations() {
            // For each canvas:
            ['sagittal', 'coronal', 'horizontal'].forEach(id => {
                const canvas = document.getElementById(id + '-plane-illustration');
                if (canvas) {
                    canvas.width = 300;
                    canvas.height = 200;
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, 300, 200);

                    // Brain outline (side view)
                    ctx.beginPath();
                    ctx.ellipse(150, 110, 80, 60, 0, 0, Math.PI * 2);
                    ctx.fillStyle = '#e0e0e0';
                    ctx.fill();
                    ctx.strokeStyle = id === 'sagittal' ? '#3b82f6' : (id === 'coronal' ? '#22c55e' : '#a855f7');
                    ctx.lineWidth = 3;
                    ctx.stroke();

                    // Plane (vertical or horizontal line)
                    ctx.beginPath();
                    if (id === 'sagittal') {
                        ctx.moveTo(150, 40);
                        ctx.lineTo(150, 180);
                    } else if (id === 'coronal') {
                        ctx.moveTo(60, 100);
                        ctx.lineTo(240, 100);
                    } else {
                        ctx.moveTo(70, 100);
                        ctx.lineTo(230, 100);
                    }
                    ctx.strokeStyle = id === 'sagittal' ? '#3b82f6' : (id === 'coronal' ? '#22c55e' : '#a855f7');
                    ctx.lineWidth = 4;
                    ctx.stroke();

                    // Labels
                    ctx.font = 'bold 14px Arial';
                    ctx.fillStyle = id === 'sagittal' ? '#3b82f6' : (id === 'coronal' ? '#22c55e' : '#a855f7');
                    ctx.textAlign = 'center';
                    ctx.fillText(id.charAt(0).toUpperCase() + id.slice(1) + ' Plane', 150, 30);
                    ctx.fillStyle = '#222';
                    if (id === 'sagittal') {
                        ctx.fillText('Anterior', 230, 70);
                        ctx.fillText('Posterior', 70, 70);
                        ctx.fillText('Dorsal', 150, 55);
                        ctx.fillText('Ventral', 150, 185);
                    } else if (id === 'coronal') {
                        ctx.fillText('Left', 70, 110);
                        ctx.fillText('Right', 230, 110);
                        ctx.fillText('Dorsal', 150, 55);
                        ctx.fillText('Ventral', 150, 185);
                    } else {
                        ctx.fillText('Anterior', 150, 55);
                        ctx.fillText('Posterior', 150, 185);
                        ctx.fillText('Left', 70, 110);
                        ctx.fillText('Right', 230, 110);
                    }
                }
            });
        }

        // Brain Section Display
        function initBrainSectionDisplay() {
            const display = document.getElementById('brain-section-display');
            display.innerHTML = '';
            const width = 500,
                height = 350;
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            display.appendChild(canvas);
            updateBrainSectionDisplay('sagittal');
        }

        function updateBrainSectionDisplay(plane, position = 50) {
            try {
                const display = document.getElementById('brain-section-display');
                if (!display) return;

                const canvas = display.querySelector('canvas');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Black MRI-like background
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Margins for safe drawing area (increase slightly)
                const marginX = canvas.width * 0.12;
                const marginY = canvas.height * 0.12;
                const drawW = canvas.width - marginX * 2;
                const drawH = canvas.height - marginY * 2;

                // Normalize position to 0-1
                const normalizedPosition = position / 100;

                // Helper for white outline
                function drawOutlineEllipse(cx, cy, rx, ry) {
                    ctx.beginPath();
                    ctx.ellipse(cx, cy, rx, ry, 0, 0, Math.PI * 2);
                    ctx.fillStyle = '#fff';
                    ctx.shadowColor = '#222';
                    ctx.shadowBlur = 8;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                    ctx.strokeStyle = '#bbb';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                // Helper for label
                function drawLabel(text, x, y, color = '#fff', size = 15, align = 'center') {
                    ctx.font = `bold ${size}px Arial`;
                    ctx.fillStyle = color;
                    ctx.textAlign = align;
                    ctx.fillText(text, x, y);
                }

                if (plane === 'sagittal') {
                    // Brain outline (side view) - slightly smaller radii
                    drawOutlineEllipse(
                        marginX + drawW * 0.5,
                        marginY + drawH * 0.52,
                        drawW * 0.35, // was 0.38
                        drawH * 0.38  // was 0.42
                    );

                    // Corpus callosum (midline only)
                    if (Math.abs(normalizedPosition - 0.5) < 0.12) {
                        ctx.beginPath();
                        ctx.moveTo(marginX + drawW * 0.38, marginY + drawH * 0.45);
                        ctx.bezierCurveTo(
                            marginX + drawW * 0.45, marginY + drawH * 0.35,
                            marginX + drawW * 0.62, marginY + drawH * 0.35,
                            marginX + drawW * 0.62, marginY + drawH * 0.48
                        );
                        ctx.strokeStyle = '#ff9999';
                        ctx.lineWidth = 4;
                        ctx.stroke();

                        // Third ventricle
                        ctx.beginPath();
                        ctx.ellipse(
                            marginX + drawW * 0.5,
                            marginY + drawH * 0.54,
                            drawW * 0.045,
                            drawH * 0.045,
                            0, 0, Math.PI * 2
                        );
                        ctx.fillStyle = '#111';
                        ctx.fill();

                        // Brainstem
                        ctx.beginPath();
                        ctx.moveTo(marginX + drawW * 0.44, marginY + drawH * 0.7);
                        ctx.bezierCurveTo(
                            marginX + drawW * 0.46, marginY + drawH * 0.8,
                            marginX + drawW * 0.54, marginY + drawH * 0.8,
                            marginX + drawW * 0.56, marginY + drawH * 0.7
                        );
                        ctx.lineWidth = 8;
                        ctx.strokeStyle = '#ccc';
                        ctx.stroke();

                        // Flexure arrow
                        ctx.save();
                        ctx.strokeStyle = '#ff3333';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(marginX + drawW * 0.44, marginY + drawH * 0.7);
                        ctx.lineTo(marginX + drawW * 0.35, marginY + drawH * 0.62);
                        ctx.stroke();
                        ctx.restore();

                        drawLabel('120¬∞ Flexure', marginX + drawW * 0.28, marginY + drawH * 0.62, '#ff3333', 13, 'left');
                    } else {
                        // Lateral ventricle (off-midline)
                        ctx.beginPath();
                        ctx.ellipse(
                            marginX + drawW * 0.55,
                            marginY + drawH * 0.48,
                            drawW * 0.06,
                            drawH * 0.03,
                            0, 0, Math.PI * 2
                        );
                        ctx.fillStyle = '#111';
                        ctx.fill();
                    }

                    // Direction labels
                    drawLabel('Anterior', marginX + drawW * 0.92, marginY + drawH * 0.18);
                    drawLabel('Posterior', marginX + drawW * 0.08, marginY + drawH * 0.18);
                    drawLabel('Dorsal', marginX + drawW * 0.5, marginY + drawH * 0.08);
                    drawLabel('Ventral', marginX + drawW * 0.5, marginY + drawH * 0.98);

                    // Key structure labels
                    drawLabel('Corpus Callosum', marginX + drawW * 0.7, marginY + drawH * 0.38, '#ff9999', 13, 'left');
                    drawLabel('Brainstem', marginX + drawW * 0.6, marginY + drawH * 0.8, '#ccc', 13, 'left');
                    drawLabel('Ventricle', marginX + drawW * 0.55, marginY + drawH * 0.57, '#fff', 13, 'left');

                } else if (plane === 'coronal') {
                    // Brain outline (frontal view) - slightly smaller radii
                    drawOutlineEllipse(
                        marginX + drawW * 0.5,
                        marginY + drawH * 0.5,
                        drawW * 0.36, // was 0.42
                        drawH * 0.33  // was 0.38
                    );

                    // Midline
                    ctx.beginPath();
                    ctx.moveTo(marginX + drawW * 0.5, marginY + drawH * 0.15);
                    ctx.lineTo(marginX + drawW * 0.5, marginY + drawH * 0.85);
                    ctx.strokeStyle = '#bbb';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Lateral ventricles
                    ctx.beginPath();
                    ctx.ellipse(
                        marginX + drawW * 0.35,
                        marginY + drawH * 0.5,
                        drawW * 0.06,
                        drawH * 0.08,
                        0, 0, Math.PI * 2
                    );
                    ctx.fillStyle = '#111';
                    ctx.fill();

                    ctx.beginPath();
                    ctx.ellipse(
                        marginX + drawW * 0.65,
                        marginY + drawH * 0.5,
                        drawW * 0.06,
                        drawH * 0.08,
                        0, 0, Math.PI * 2
                    );
                    ctx.fillStyle = '#111';
                    ctx.fill();

                    // Thalamus (center)
                    ctx.beginPath();
                    ctx.ellipse(
                        marginX + drawW * 0.5,
                        marginY + drawH * 0.6,
                        drawW * 0.07,
                        drawH * 0.04,
                        0, 0, Math.PI * 2
                    );
                    ctx.fillStyle = '#ccc';
                    ctx.fill();

                    // Brainstem (if posterior)
                    if (normalizedPosition > 0.5) {
                        ctx.beginPath();
                        ctx.rect(
                            marginX + drawW * 0.43,
                            marginY + drawH * 0.85,
                            drawW * 0.14,
                            drawH * 0.12
                        );
                        ctx.fillStyle = '#ddd';
                        ctx.fill();
                    }

                    // Direction labels
                    drawLabel('Right', marginX + drawW * 0.08, marginY + drawH * 0.5);
                    drawLabel('Left', marginX + drawW * 0.92, marginY + drawH * 0.5);
                    drawLabel('Superior', marginX + drawW * 0.5, marginY + drawH * 0.08);
                    drawLabel('Inferior', marginX + drawW * 0.5, marginY + drawH * 0.98);

                    // Key structure labels
                    drawLabel('Lateral Ventricle', marginX + drawW * 0.28, marginY + drawH * 0.45, '#fff', 13, 'left');
                    drawLabel('Thalamus', marginX + drawW * 0.5, marginY + drawH * 0.68, '#ccc', 13, 'center');
                    drawLabel('Brainstem', marginX + drawW * 0.5, marginY + drawH * 0.98, '#ddd', 13, 'center');

                } else if (plane === 'horizontal') {
                    // Brain outline (axial view) - slightly smaller radii
                    drawOutlineEllipse(
                        marginX + drawW * 0.5,
                        marginY + drawH * 0.5,
                        drawW * 0.33, // was 0.38
                        drawH * 0.28  // was 0.32
                    );

                    // Lateral ventricles
                    ctx.beginPath();
                    ctx.ellipse(
                        marginX + drawW * 0.4,
                        marginY + drawH * 0.5,
                        drawW * 0.06,
                        drawH * 0.09,
                        0, 0, Math.PI * 2
                    );
                    ctx.fillStyle = '#111';
                    ctx.fill();

                    ctx.beginPath();
                    ctx.ellipse(
                        marginX + drawW * 0.6,
                        marginY + drawH * 0.5,
                        drawW * 0.06,
                        drawH * 0.09,
                        0, 0, Math.PI * 2
                    );
                    ctx.fillStyle = '#111';
                    ctx.fill();

                    // Third ventricle (center)
                    ctx.beginPath();
                    ctx.ellipse(
                        marginX + drawW * 0.5,
                        marginY + drawH * 0.5,
                        drawW * 0.03,
                        drawH * 0.04,
                        0, 0, Math.PI * 2
                    );
                    ctx.fillStyle = '#222';
                    ctx.fill();

                    // Cerebellum (inferior)
                    if (normalizedPosition > 0.6) {
                        ctx.beginPath();
                        ctx.ellipse(
                            marginX + drawW * 0.5,
                            marginY + drawH * 0.7,
                            drawW * 0.16,
                            drawH * 0.08,
                            0, 0, Math.PI * 2
                        );
                        ctx.fillStyle = '#ddd';
                        ctx.fill();

                        // Vermis
                        ctx.beginPath();
                        ctx.moveTo(marginX + drawW * 0.5, marginY + drawH * 0.62);
                        ctx.lineTo(marginX + drawW * 0.5, marginY + drawH * 0.78);
                        ctx.strokeStyle = '#bbb';
                        ctx.lineWidth = 3;
                        ctx.stroke();
                    }

                    // Direction labels
                    drawLabel('Anterior', marginX + drawW * 0.92, marginY + drawH * 0.5);
                    drawLabel('Posterior', marginX + drawW * 0.08, marginY + drawH * 0.5);
                    drawLabel('Left', marginX + drawW * 0.5, marginY + drawH * 0.08);
                    drawLabel('Right', marginX + drawW * 0.5, marginY + drawH * 0.98);

                    // Key structure labels
                    drawLabel('Lateral Ventricle', marginX + drawW * 0.28, marginY + drawH * 0.45, '#fff', 13, 'left');
                    drawLabel('Third Ventricle', marginX + drawW * 0.5, marginY + drawH * 0.57, '#fff', 13, 'center');
                    if (normalizedPosition > 0.6) {
                        drawLabel('Cerebellum', marginX + drawW * 0.5, marginY + drawH * 0.8, '#ddd', 13, 'center');
                    }
                }

                // Plane indicator
                drawLabel(
                    plane.charAt(0).toUpperCase() + plane.slice(1) + ' Section',
                    canvas.width * 0.5,
                    canvas.height - marginY * 0.3,
                    plane === 'sagittal' ? '#3b82f6' : (plane === 'coronal' ? '#22c55e' : '#a855f7'),
                    17,
                    'center'
                );
            } catch (error) {
                console.error("Error updating brain section display:", error);
            }
        }

        // Direction Visualization
        function initDirectionVisualization() {
            try {
                updateDirectionVisualization(1); // Start with hindbrain
            } catch (error) {
                console.error("Error initializing direction visualization:", error);
                if (document.getElementById('direction-visualization')) {
                    document.getElementById('direction-visualization').innerHTML = `
                        <div class="flex items-center justify-center h-full bg-red-50 text-red-800 p-4 rounded-lg">
                            <p>Error loading direction visualization. Please try refreshing the page.</p>
                        </div>
                    `;
                }
            }
        }

        function updateDirectionVisualization(region) {
            try {
                const container = document.getElementById('direction-visualization');
                if (!container) return;

                // Clear previous arrows
                container.innerHTML = '';

                // Draw brain outline based on region
                const brainOutline = document.createElement('div');
                brainOutline.className = 'absolute inset-0 flex items-center justify-center';

                if (region === 0) { // Spinal cord
                    brainOutline.innerHTML = `
                        <div class="w-1/4 h-3/4 bg-gray-200 rounded-lg border-2 border-gray-400 flex items-center justify-center">
                            <span class="text-gray-600 font-bold">Spinal Cord</span>
                        </div>
                    `;
                } else if (region === 1) { // Hindbrain
                    brainOutline.innerHTML = `
                        <div class="relative">
                            <div class="w-32 h-32 bg-gray-200 rounded-full border-2 border-gray-400 flex items-center justify-center">
                                <span class="text-gray-600 font-bold">Hindbrain</span>
                            </div>
                            <div class="w-8 h-24 bg-gray-300 rounded-b-lg border-2 border-gray-400 mx-auto -mt-2">
                            </div>
                        </div>
                    `;
                } else { // Forebrain
                    brainOutline.innerHTML = `
                        <div class="relative">
                            <div class="w-48 h-40 bg-gray-200 rounded-3xl border-2 border-gray-400 flex items-center justify-center">
                                <span class="text-gray-600 font-bold">Forebrain</span>
                            </div>
                            <div class="w-8 h-16 bg-gray-300 rounded-b-lg border-2 border-gray-400 mx-auto -mt-2 rotate-90 origin-top">
                            </div>
                        </div>
                    `;
                }

                container.appendChild(brainOutline);

                // Add direction arrows
                const directions = [
                    { name: 'Rostral', color: 'bg-red-500', opposite: 'Caudal' },
                    { name: 'Dorsal', color: 'bg-yellow-500', opposite: 'Ventral' },
                    { name: 'Anterior', color: 'bg-blue-500', opposite: 'Posterior' },
                    { name: 'Superior', color: 'bg-green-500', opposite: 'Inferior' }
                ];

                // Position arrows based on region
                if (region === 0) { // Spinal cord
                    addDirectionArrow(container, 'Rostral', 'bg-red-500', '50%', '10%', 'Caudal', '50%', '90%');
                    addDirectionArrow(container, 'Dorsal', 'bg-yellow-500', '10%', '50%', 'Ventral', '90%', '50%');
                    addDirectionArrow(container, 'Superior', 'bg-green-500', '50%', '10%', 'Inferior', '50%', '90%');
                    addDirectionArrow(container, 'Posterior', 'bg-blue-500', '10%', '50%', 'Anterior', '90%', '50%');
                } else if (region === 1) { // Hindbrain
                    addDirectionArrow(container, 'Rostral', 'bg-red-500', '50%', '10%', 'Caudal', '50%', '90%');
                    addDirectionArrow(container, 'Dorsal', 'bg-yellow-500', '10%', '50%', 'Ventral', '90%', '50%');
                    addDirectionArrow(container, 'Superior', 'bg-green-500', '50%', '10%', 'Inferior', '50%', '90%');
                    addDirectionArrow(container, 'Posterior', 'bg-blue-500', '10%', '50%', 'Anterior', '90%', '50%');
                } else { // Forebrain
                    addDirectionArrow(container, 'Rostral', 'bg-red-500', '90%', '50%', 'Caudal', '10%', '50%');
                    addDirectionArrow(container, 'Dorsal', 'bg-yellow-500', '50%', '10%', 'Ventral', '50%', '90%');
                    addDirectionArrow(container, 'Anterior', 'bg-blue-500', '90%', '50%', 'Posterior', '10%', '50%');
                    addDirectionArrow(container, 'Superior', 'bg-green-500', '50%', '10%', 'Inferior', '50%', '90%');
                }

                // Add region label
                const regionLabel = document.createElement('div');
                regionLabel.className = 'absolute bottom-2 left-0 right-0 text-center text-gray-700 font-bold';
                regionLabel.textContent = region === 0 ? 'Spinal Cord' : (region === 1 ? 'Hindbrain' : 'Forebrain');
                container.appendChild(regionLabel);

                // Add note about the flexure if showing forebrain
                if (region === 2) {
                    const flexureNote = document.createElement('div');
                    flexureNote.className = 'absolute top-2 left-0 right-0 text-center text-red-600 text-sm font-medium';
                    flexureNote.textContent = 'Note how rostral/caudal direction changes due to the flexure!';
                    container.appendChild(flexureNote);
                }
            } catch (error) {
                console.error("Error updating direction visualization:", error);
            }
        }

        function addDirectionArrow(container, name, color, startX, startY, oppositeName, endX, endY) {
            try {
                // Start arrow
                const startArrow = document.createElement('div');
                startArrow.className = `direction-arrow ${color} text-white`;
                startArrow.style.left = startX;
                startArrow.style.top = startY;
                startArrow.style.transform = 'translate(-50%, -50%)';
                startArrow.textContent = name.charAt(0);
                startArrow.title = name;
                container.appendChild(startArrow);

                // End arrow
                const endArrow = document.createElement('div');
                endArrow.className = `direction-arrow ${color} text-white`;
                endArrow.style.left = endX;
                endArrow.style.top = endY;
                endArrow.style.transform = 'translate(-50%, -50%)';
                endArrow.textContent = oppositeName.charAt(0);
                endArrow.title = oppositeName;
                container.appendChild(endArrow);

                // Line connecting arrows
                const line = document.createElement('div');
                line.className = `absolute ${color}`;

                // Calculate line position and dimensions
                const isHorizontal = startY === endY;

                if (isHorizontal) {
                    line.style.height = '2px';
                    line.style.width = `calc(${endX} - ${startX})`;
                    line.style.left = startX;
                    line.style.top = startY;
                    line.style.transform = 'translateY(-50%)';
                } else {
                    line.style.width = '2px';
                    line.style.height = `calc(${endY} - ${startY})`;
                    line.style.left = startX;
                    line.style.top = startY;
                    line.style.transform = 'translateX(-50%)';
                }

                container.appendChild(line);
            } catch (error) {
                console.error("Error adding direction arrow:", error);
            }
        }
    </script>
    <script>window.parent.postMessage({ action: "ready" }, "*");

        window.console = new Proxy(console, {
            get(target, prop) {
                if (['log', 'warn', 'error'].includes(prop)) {
                    return new Proxy(target[prop], {
                        apply(fn, thisArg, args) {
                            fn.apply(thisArg, args);
                            window.parent.postMessage({
                                action: 'console',
                                type: prop,
                                args: args.map((arg) => {
                                    try {
                                        return JSON.stringify(arg).replace(/^["']|["']$/g, '');
                                    } catch (e) {
                                        return arg;
                                    }
                                })
                            }, '*');
                        }
                    });
                }
                return target[prop];
            }
        });
    </script>
</body>

</html>
